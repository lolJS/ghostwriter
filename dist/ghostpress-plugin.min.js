/*! ghostpress-plugin 09-08-2014 */
requirejs.config({baseUrl:"assets/vendor",paths:{app:"../js/app",jquery:"jquery/dist/jquery",scribe:"scribe/scribe","scribe-plugin-blockquote-command":"scribe-plugin-blockquote-command/scribe-plugin-blockquote-command","scribe-plugin-curly-quotes":"scribe-plugin-curly-quotes/scribe-plugin-curly-quotes","scribe-plugin-formatter-plain-text-convert-new-lines-to-html":"scribe-plugin-formatter-plain-text-convert-new-lines-to-html/scribe-plugin-formatter-plain-text-convert-new-lines-to-html","scribe-plugin-heading-command":"scribe-plugin-heading-command/scribe-plugin-heading-command","scribe-plugin-intelligent-unlink-command":"scribe-plugin-intelligent-unlink-command/scribe-plugin-intelligent-unlink-command","scribe-plugin-link-prompt-command":"scribe-plugin-link-prompt-command/scribe-plugin-link-prompt-command","scribe-plugin-sanitizer":"scribe-plugin-sanitizer/scribe-plugin-sanitizer","scribe-plugin-smart-lists":"scribe-plugin-smart-lists/scribe-plugin-smart-lists","scribe-plugin-toolbar":"scribe-plugin-toolbar/scribe-plugin-toolbar",beautify:"js-beautify/js/lib/beautify","beautify-html":"js-beautify/js/lib/beautify-html","beautify-css":"js-beautify/js/lib/beautify-css"}}),requirejs(["ghostwriter"]),define("ghostwriter",["jquery","scribe","scribe-plugin-blockquote-command","scribe-plugin-curly-quotes","scribe-plugin-formatter-plain-text-convert-new-lines-to-html","scribe-plugin-heading-command","scribe-plugin-intelligent-unlink-command","scribe-plugin-link-prompt-command","scribe-plugin-sanitizer","scribe-plugin-smart-lists","scribe-plugin-toolbar","beautify-html"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(b){var c,d,e=a(".ghost-writer").eq(a(b.delegateTarget).attr("data-gw-instance"));return d=b.pageX-e.width()/2<0?0:b.pageX+e.width()/2>a(window).width()-25?a(window).width()-(e.width()+12):b.pageX-e.width()/2,c=b.pageY-50<0?0:b.pageY-70,{top:c,left:d+3}}function n(b){var c=a(".ghost-writer").eq(a(b.delegateTarget).attr("data-gw-instance")),d=b.target||b.srcElement;if(d.isContentEditable)if(window.getSelection().isCollapsed)c.addClass("hidden");else{var e=m(b);c.css("top",e.top),c.css("left",e.left),c.removeClass("hidden")}}function o(){a(".ghost-writer").each(function(b,c){a(c).hasClass("hidden")||a(c).addClass("hidden")})}var p='<div class="ghost-writer hidden"><div class="toolbar"><ul><li><button data-command-name="bold"><span class="fontawesome-bold"></span></button></li><li><button data-command-name="italic"><span class="fontawesome-italic"></span></button></li><li><button data-command-name="strikeThrough"><span class="fontawesome-strikethrough"></span></button></li><li><button data-command-name="removeFormat"><span class="fontawesome-remove"></span></button></li><li><button data-command-name="linkPrompt"><span class="fontawesome-link"></span></button></li><li><button data-command-name="insertOrderedList"><span class="fontawesome-list-ol"></span></button></li><li><button data-command-name="insertUnorderedList"><span class="fontawesome-list-ul"></span></button></li><li><button data-command-name="indent"><span class="fontawesome-indent-left"></span></button></li><li><button data-command-name="outdent"><span class="fontawesome-indent-right"></span></button></li><li><button data-command-name="blockquote"><span class="fontawesome-quote-left"></span></button></li><li><button data-command-name="h2"><span class="fontawesome-text-height"></span></button></li><li><button data-command-name="undo"><span class="fontawesome-undo"></span></button></li></ul></div><div class="arrow-down"></div></div>',q=l.html_beautify;a(".ghost-writer-editable").each(function(l,m){function n(){var b=a(".scribe-html code");b.empty(),b.text(q(o.getHTML())),hljs.configure({tabReplace:"  "}),hljs.highlightBlock(b[0])}a(m).addClass("scribe"),a("body").append(p),a(".toolbar")[l].id="scribe-toolbar-"+l,a(".ghost-writer-editable")[l].setAttribute("data-gw-instance",l);var o=new b(m,{allowBlockElements:!0});o.on("content-changed",n),o.use(c()),o.use(f(2)),o.use(g()),o.use(h()),o.use(k(document.getElementById("scribe-toolbar-"+l))),o.use(j()),o.use(d()),o.use(i({tags:{p:{},br:{},b:{},strong:{},i:{},strike:{},blockquote:{},ol:{},ul:{},li:{},a:{href:!0},h2:{}}})),o.use(e()),o.setContent(o.allowsBlockElements()?'<h2>Hello, World!</h2><blockquote><p>“Easy reading is damned hard writing.” — Nathaniel Hawthorne</p></blockquote><p>GhostWriter is a small JS application that lets you edit content directly in your browser. The main focus is <i>quick</i>, <b>easy</b>, and <b>hassle free</b> composing without writing HTML. GhostWriter is a wrapper on top of <a href="http://theguardian.com">The Guardian’s</a> <a href="http://github.com/guardian/scribe">Scribe</a> content editable framework. Scribe is a plugin based framework which standardized content editable elements across browsers.<br></p><p>Editing is a snap.</p><ol><li>Click on any editable element.</li><li>Start writing!<br></li></ol><p>In sit amet varius ipsum. Sed sit amet neque vitae eros elementum gravida non a arcu. Proin vel ligula magna. Aenean vestibulum dui nec suscipit molestie. Vestibulum a ante rutrum, volutpat mi vestibulum, scelerisque quam. Sed facilisis sed lectus eget consequat. Duis dignissim libero in suscipit pretium. Pellentesque laoreet sapien mauris, nec suscipit nunc bibendum in. Proin sem dui, mattis eget rhoncus quis, consequat sed arcu. Morbi interdum pharetra lorem id dictum.</p><p><i>GhostWriter was used in the making of this post.</i><br></p>':"Hello, World!")}),a(".scribe").each(function(b,c){a(c).attr("data-gw-instace");a(c).on({mousedown:o,dblclick:n,mouseup:function(a){setTimeout(function(){n(a)},100)},keyup:n})})}),define("lodash-amd/modern/internals/isNative",[],function(){function a(a){return"function"==typeof a&&d.test(a)}var b=Object.prototype,c=b.toString,d=RegExp("^"+String(c).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");return a}),define("lodash-amd/modern/internals/objectTypes",[],function(){var a={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1};return a}),define("lodash-amd/modern/objects/isObject",["../internals/objectTypes"],function(a){function b(b){return!(!b||!a[typeof b])}return b}),define("lodash-amd/modern/internals/shimKeys",["./objectTypes"],function(a){var b=Object.prototype,c=b.hasOwnProperty,d=function(b){var d,e=b,f=[];if(!e)return f;if(!a[typeof b])return f;for(d in e)c.call(e,d)&&f.push(d);return f};return d}),define("lodash-amd/modern/objects/keys",["../internals/isNative","./isObject","../internals/shimKeys"],function(a,b,c){var d=a(d=Object.keys)&&d,e=d?function(a){return b(a)?d(a):[]}:c;return e}),define("lodash-amd/modern/objects/defaults",["./keys","../internals/objectTypes"],function(a,b){var c=function(c,d,e){var f,g=c,h=g;if(!g)return h;for(var i=arguments,j=0,k="number"==typeof e?2:i.length;++j<k;)if(g=i[j],g&&b[typeof g])for(var l=-1,m=b[typeof g]&&a(g),n=m?m.length:0;++l<n;)f=m[l],"undefined"==typeof h[f]&&(h[f]=g[f]);return h};return c}),define("lodash-amd/modern/objects/isArguments",[],function(){function a(a){return a&&"object"==typeof a&&"number"==typeof a.length&&d.call(a)==b||!1}var b="[object Arguments]",c=Object.prototype,d=c.toString;return a}),define("lodash-amd/modern/objects/isArray",["../internals/isNative"],function(a){var b="[object Array]",c=Object.prototype,d=c.toString,e=a(e=Array.isArray)&&e,f=e||function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&d.call(a)==b||!1};return f}),define("lodash-amd/modern/internals/baseFlatten",["../objects/isArguments","../objects/isArray"],function(a,b){function c(d,e,f,g){for(var h=(g||0)-1,i=d?d.length:0,j=[];++h<i;){var k=d[h];if(k&&"object"==typeof k&&"number"==typeof k.length&&(b(k)||a(k))){e||(k=c(k,e,f));var l=-1,m=k.length,n=j.length;for(j.length+=m;++l<m;)j[n++]=k[l]}else f||j.push(k)}return j}return c}),define("lodash-amd/modern/utilities/noop",[],function(){function a(){}return a}),define("lodash-amd/modern/internals/baseCreate",["./isNative","../objects/isObject","../utilities/noop"],function(a,b){function c(a){return b(a)?d(a):{}}var d=a(d=Object.create)&&d;return d||(c=function(){function a(){}return function(c){if(b(c)){a.prototype=c;var d=new a;a.prototype=null}return d||window.Object()}}()),c}),define("lodash-amd/modern/internals/setBindData",["./isNative","../utilities/noop"],function(a,b){var c={configurable:!1,enumerable:!1,value:null,writable:!1},d=function(){try{var b={},c=a(c=Object.defineProperty)&&c,d=c(b,b,b)&&c}catch(e){}return d}(),e=d?function(a,b){c.value=b,d(a,"__bindData__",c)}:b;return e}),define("lodash-amd/modern/internals/slice",[],function(){function a(a,b,c){b||(b=0),"undefined"==typeof c&&(c=a?a.length:0);for(var d=-1,e=c-b||0,f=Array(0>e?0:e);++d<e;)f[d]=a[b+d];return f}return a}),define("lodash-amd/modern/internals/baseBind",["./baseCreate","../objects/isObject","./setBindData","./slice"],function(a,b,c,d){function e(e){function f(){if(i){var c=d(i);g.apply(c,arguments)}if(this instanceof f){var e=a(h.prototype),k=h.apply(e,c||arguments);return b(k)?k:e}return h.apply(j,c||arguments)}var h=e[0],i=e[2],j=e[4];return c(f,e),f}var f=[],g=f.push;return e}),define("lodash-amd/modern/internals/baseCreateWrapper",["./baseCreate","../objects/isObject","./setBindData","./slice"],function(a,b,c,d){function e(f){function h(){var c=o?m:this;if(k){var f=d(k);g.apply(f,arguments)}if((l||q)&&(f||(f=d(arguments)),l&&g.apply(f,l),q&&f.length<n))return j|=16,e([i,r?j:-4&j,f,null,m,n]);if(f||(f=arguments),p&&(i=c[s]),this instanceof h){c=a(i.prototype);var t=i.apply(c,f);return b(t)?t:c}return i.apply(c,f)}var i=f[0],j=f[1],k=f[2],l=f[3],m=f[4],n=f[5],o=1&j,p=2&j,q=4&j,r=8&j,s=i;return c(h,f),h}var f=[],g=f.push;return e}),define("lodash-amd/modern/objects/isFunction",[],function(){function a(a){return"function"==typeof a}return a}),define("lodash-amd/modern/internals/createWrapper",["./baseBind","./baseCreateWrapper","../objects/isFunction","./slice"],function(a,b,c,d){function e(f,i,j,k,l,m){var n=1&i,o=2&i,p=4&i,q=16&i,r=32&i;if(!o&&!c(f))throw new TypeError;q&&!j.length&&(i&=-17,q=j=!1),r&&!k.length&&(i&=-33,r=k=!1);var s=f&&f.__bindData__;if(s&&s!==!0)return s=d(s),s[2]&&(s[2]=d(s[2])),s[3]&&(s[3]=d(s[3])),!n||1&s[1]||(s[4]=l),!n&&1&s[1]&&(i|=8),!p||4&s[1]||(s[5]=m),q&&g.apply(s[2]||(s[2]=[]),j),r&&h.apply(s[3]||(s[3]=[]),k),s[1]|=i,e.apply(null,s);var t=1==i||17===i?a:b;return t([f,i,j,k,l,m])}var f=[],g=f.push,h=f.unshift;return e}),define("lodash-amd/modern/functions/bind",["../internals/createWrapper","../internals/slice"],function(a,b){function c(c,d){return arguments.length>2?a(c,17,b(arguments,2),null,d):a(c,1,null,null,d)}return c}),define("lodash-amd/modern/utilities/identity",[],function(){function a(a){return a}return a}),define("lodash-amd/modern/support",["./internals/isNative"],function(a){var b=/\bthis\b/,c={};return c.funcDecomp=!a(window.WinRTError)&&b.test(function(){return this}),c.funcNames="string"==typeof Function.name,c}),define("lodash-amd/modern/internals/baseCreateCallback",["../functions/bind","../utilities/identity","./setBindData","../support"],function(a,b,c,d){function e(e,i,j){if("function"!=typeof e)return b;if("undefined"==typeof i||!("prototype"in e))return e;var k=e.__bindData__;if("undefined"==typeof k&&(d.funcNames&&(k=!e.name),k=k||!d.funcDecomp,!k)){var l=h.call(e);d.funcNames||(k=!f.test(l)),k||(k=g.test(l),c(e,k))}if(k===!1||k!==!0&&1&k[1])return e;switch(j){case 1:return function(a){return e.call(i,a)};case 2:return function(a,b){return e.call(i,a,b)};case 3:return function(a,b,c){return e.call(i,a,b,c)};case 4:return function(a,b,c,d){return e.call(i,a,b,c,d)}}return a(e,i)}var f=/^\s*function[ \n\r\t]+\w/,g=/\bthis\b/,h=Function.prototype.toString;return e}),define("lodash-amd/modern/objects/forIn",["../internals/baseCreateCallback","../internals/objectTypes"],function(a,b){var c=function(c,d,e){var f,g=c,h=g;if(!g)return h;if(!b[typeof g])return h;d=d&&"undefined"==typeof e?d:a(d,e,3);for(f in g)if(d(g[f],f,c)===!1)return h;return h};return c}),define("lodash-amd/modern/internals/arrayPool",[],function(){var a=[];return a}),define("lodash-amd/modern/internals/getArray",["./arrayPool"],function(a){function b(){return a.pop()||[]}return b}),define("lodash-amd/modern/internals/maxPoolSize",[],function(){var a=40;return a}),define("lodash-amd/modern/internals/releaseArray",["./arrayPool","./maxPoolSize"],function(a,b){function c(c){c.length=0,a.length<b&&a.push(c)}return c}),define("lodash-amd/modern/internals/baseIsEqual",["../objects/forIn","./getArray","../objects/isFunction","./objectTypes","./releaseArray"],function(a,b,c,d,e){function f(o,r,s,t,u,v){if(s){var w=s(o,r);if("undefined"!=typeof w)return!!w}if(o===r)return 0!==o||1/o==1/r;var x=typeof o,y=typeof r;if(!(o!==o||o&&d[x]||r&&d[y]))return!1;if(null==o||null==r)return o===r;var z=p.call(o),A=p.call(r);if(z==g&&(z=l),A==g&&(A=l),z!=A)return!1;switch(z){case i:case j:return+o==+r;case k:return o!=+o?r!=+r:0==o?1/o==1/r:o==+r;case m:case n:return o==String(r)}var B=z==h;if(!B){var C=q.call(o,"__wrapped__"),D=q.call(r,"__wrapped__");if(C||D)return f(C?o.__wrapped__:o,D?r.__wrapped__:r,s,t,u,v);if(z!=l)return!1;var E=o.constructor,F=r.constructor;if(E!=F&&!(c(E)&&E instanceof E&&c(F)&&F instanceof F)&&"constructor"in o&&"constructor"in r)return!1}var G=!u;u||(u=b()),v||(v=b());for(var H=u.length;H--;)if(u[H]==o)return v[H]==r;var I=0;if(w=!0,u.push(o),v.push(r),B){if(H=o.length,I=r.length,w=I==H,w||t)for(;I--;){var J=H,K=r[I];if(t)for(;J--&&!(w=f(o[J],K,s,t,u,v)););else if(!(w=f(o[I],K,s,t,u,v)))break}}else a(r,function(a,b,c){return q.call(c,b)?(I++,w=q.call(o,b)&&f(o[b],a,s,t,u,v)):void 0}),w&&!t&&a(o,function(a,b,c){return q.call(c,b)?w=--I>-1:void 0});return u.pop(),v.pop(),G&&(e(u),e(v)),w}var g="[object Arguments]",h="[object Array]",i="[object Boolean]",j="[object Date]",k="[object Number]",l="[object Object]",m="[object RegExp]",n="[object String]",o=Object.prototype,p=o.toString,q=o.hasOwnProperty;return f}),define("lodash-amd/modern/utilities/property",[],function(){function a(a){return function(b){return b[a]}}return a}),define("lodash-amd/modern/functions/createCallback",["../internals/baseCreateCallback","../internals/baseIsEqual","../objects/isObject","../objects/keys","../utilities/property"],function(a,b,c,d,e){function f(f,g,h){var i=typeof f;if(null==f||"function"==i)return a(f,g,h);if("object"!=i)return e(f);var j=d(f),k=j[0],l=f[k];return 1!=j.length||l!==l||c(l)?function(a){for(var c=j.length,d=!1;c--&&(d=b(a[j[c]],f[j[c]],null,!0)););return d}:function(a){var b=a[k];return l===b&&(0!==l||1/l==1/b)}}return f}),define("lodash-amd/modern/objects/forOwn",["../internals/baseCreateCallback","./keys","../internals/objectTypes"],function(a,b,c){var d=function(d,e,f){var g,h=d,i=h;if(!h)return i;if(!c[typeof h])return i;e=e&&"undefined"==typeof f?e:a(e,f,3);for(var j=-1,k=c[typeof h]&&b(h),l=k?k.length:0;++j<l;)if(g=k[j],e(h[g],g,d)===!1)return i;return i};return d}),define("lodash-amd/modern/collections/map",["../functions/createCallback","../objects/forOwn"],function(a,b){function c(c,d,e){var f=-1,g=c?c.length:0;if(d=a(d,e,3),"number"==typeof g)for(var h=Array(g);++f<g;)h[f]=d(c[f],f,c);else h=[],b(c,function(a,b,c){h[++f]=d(a,b,c)});return h}return c}),define("lodash-amd/modern/arrays/flatten",["../internals/baseFlatten","../collections/map"],function(a,b){function c(c,d,e,f){return"boolean"!=typeof d&&null!=d&&(f=e,e="function"!=typeof d&&f&&f[d]===c?null:d,d=!1),null!=e&&(c=b(c,e,f)),a(c,d)}return c}),define("plugins/core/commands/indent",[],function(){return function(){return function(a){var b=new a.api.Command("indent");b.queryEnabled=function(){var b=new a.api.Selection,c=b.getContaining(function(a){return"UL"===a.nodeName||"OL"===a.nodeName});return a.api.Command.prototype.queryEnabled.call(this)&&a.allowsBlockElements()&&!c},a.commands.indent=b}}}),define("plugins/core/commands/insert-list",[],function(){return function(){return function(a){var b=function(b){a.api.Command.call(this,b)};b.prototype=Object.create(a.api.Command.prototype),b.prototype.constructor=b,b.prototype.execute=function(b){function c(a){if(a.length>0){var b=document.createElement(f.nodeName);a.forEach(function(a){b.appendChild(a)}),f.parentNode.insertBefore(b,f.nextElementSibling)}}if(this.queryState()){var d=new a.api.Selection,e=d.range,f=d.getContaining(function(a){return"OL"===a.nodeName||"UL"===a.nodeName}),g=d.getContaining(function(a){return"LI"===a.nodeName});a.transactionManager.run(function(){if(g){var b=new a.api.Node(g).nextAll();c(b),d.placeMarkers();var h=document.createElement("p");h.innerHTML=g.innerHTML,f.parentNode.insertBefore(h,f.nextElementSibling),g.parentNode.removeChild(g)}else{var i=Array.prototype.map.call(f.querySelectorAll("li"),function(a){return e.intersectsNode(a)&&a}).filter(function(a){return a}),j=i.slice(-1)[0],k=new a.api.Node(j).nextAll();c(k),d.placeMarkers();var l=document.createDocumentFragment();i.forEach(function(a){var b=document.createElement("p");b.innerHTML=a.innerHTML,l.appendChild(b)}),f.parentNode.insertBefore(l,f.nextElementSibling),i.forEach(function(a){a.parentNode.removeChild(a)})}0===f.childNodes.length&&f.parentNode.removeChild(f),d.selectMarkers()}.bind(this))}else a.api.Command.prototype.execute.call(this,b)},b.prototype.queryEnabled=function(){return a.api.Command.prototype.queryEnabled.call(this)&&a.allowsBlockElements()},a.commands.insertOrderedList=new b("insertOrderedList"),a.commands.insertUnorderedList=new b("insertUnorderedList")}}}),define("plugins/core/commands/outdent",[],function(){return function(){return function(a){var b=new a.api.Command("outdent");b.queryEnabled=function(){var b=new a.api.Selection,c=b.getContaining(function(a){return"UL"===a.nodeName||"OL"===a.nodeName});return a.api.Command.prototype.queryEnabled.call(this)&&a.allowsBlockElements()&&!c},a.commands.outdent=b}}}),define("plugins/core/commands/redo",[],function(){return function(){return function(a){var b=new a.api.Command("redo");b.execute=function(){var b=a.undoManager.redo();"undefined"!=typeof b&&a.restoreFromHistory(b)},b.queryEnabled=function(){return a.undoManager.position<a.undoManager.stack.length-1},a.commands.redo=b,a.el.addEventListener("keydown",function(a){a.shiftKey&&(a.metaKey||a.ctrlKey)&&90===a.keyCode&&(a.preventDefault(),b.execute())})}}}),define("plugins/core/commands/subscript",[],function(){return function(){return function(a){var b=new a.api.Command("subscript");a.commands.subscript=b}}}),define("plugins/core/commands/superscript",[],function(){return function(){return function(a){var b=new a.api.Command("superscript");a.commands.superscript=b}}}),define("plugins/core/commands/undo",[],function(){return function(){return function(a){var b=new a.api.Command("undo");b.execute=function(){var b=a.undoManager.undo();"undefined"!=typeof b&&a.restoreFromHistory(b)},b.queryEnabled=function(){return a.undoManager.position>1},a.commands.undo=b,a.el.addEventListener("keydown",function(a){a.shiftKey||!a.metaKey&&!a.ctrlKey||90!==a.keyCode||(a.preventDefault(),b.execute())})}}}),define("plugins/core/commands",["./commands/indent","./commands/insert-list","./commands/outdent","./commands/redo","./commands/subscript","./commands/superscript","./commands/undo"],function(a,b,c,d,e,f,g){return{indent:a,insertList:b,outdent:c,redo:d,subscript:e,superscript:f,undo:g}}),define("lodash-amd/modern/internals/baseIndexOf",[],function(){function a(a,b,c){for(var d=(c||0)-1,e=a?a.length:0;++d<e;)if(a[d]===b)return d;return-1}return a}),define("lodash-amd/modern/objects/isString",[],function(){function a(a){return"string"==typeof a||a&&"object"==typeof a&&d.call(a)==b||!1}var b="[object String]",c=Object.prototype,d=c.toString;return a}),define("lodash-amd/modern/collections/contains",["../internals/baseIndexOf","../objects/forOwn","../objects/isArray","../objects/isString"],function(a,b,c,d){function e(e,g,h){var i=-1,j=a,k=e?e.length:0,l=!1;return h=(0>h?f(0,k+h):h)||0,c(e)?l=j(e,g,h)>-1:"number"==typeof k?l=(d(e)?e.indexOf(g,h):j(e,g,h))>-1:b(e,function(a){return++i>=h?!(l=a===g):void 0}),l}var f=Math.max;return e}),define("lodash-amd/modern/objects/values",["./keys"],function(a){function b(b){for(var c=-1,d=a(b),e=d.length,f=Array(e);++c<e;)f[c]=b[d[c]];return f}return b}),define("lodash-amd/modern/collections/toArray",["../objects/isString","../internals/slice","../objects/values"],function(a,b,c){function d(a){return a&&"number"==typeof a.length?b(a):c(a)}return d}),define("scribe-common/src/element",["lodash-amd/modern/collections/contains"],function(a){function b(b){return a(e,b.nodeName)}function c(a){return a.nodeType===Node.ELEMENT_NODE&&"scribe-marker"===a.className}function d(a,b){for(;b.childNodes.length>0;)a.insertBefore(b.childNodes[0],b);a.removeChild(b)}var e=["P","LI","DIV","BLOCKQUOTE","UL","OL","H1","H2","H3","H4","H5","H6"];return{isBlockElement:b,isSelectionMarkerNode:c,unwrap:d}}),define("scribe-common/src/node",[],function(){function a(a){return a.nodeType===Node.TEXT_NODE&&""===a.textContent}function b(a,b){return b.parentNode.insertBefore(a,b.nextSibling)}function c(a){return a.parentNode.removeChild(a)}return{isEmptyTextNode:a,insertAfter:b,removeNode:c}}),define("dom-observer",["lodash-amd/modern/arrays/flatten","lodash-amd/modern/collections/toArray","scribe-common/src/element","scribe-common/src/node"],function(a,b,c,d){function e(e,f){function g(e){var f=a(e.map(function(a){var c=b(a.addedNodes),d=b(a.removedNodes);return c.concat(d)})),g=f.filter(function(a){return!d.isEmptyTextNode(a)}).filter(function(a){return!c.isSelectionMarkerNode(a)});return g.length>0}var h=!1,i=new MutationObserver(function(a){if(!h&&g(a)){h=!0;try{f()}finally{setTimeout(function(){h=!1},0)}}});return i.observe(e,{attributes:!0,childList:!0,subtree:!0}),i}return e}),define("plugins/core/events",["lodash-amd/modern/collections/contains","../../dom-observer"],function(a,b){return function(){return function(c){var d=function(){setTimeout(function(){c.pushHistory()}.bind(c),0),c.el.removeEventListener("focus",d)}.bind(c);c.el.addEventListener("focus",d),c.el.addEventListener("focus",function(){function a(b){var c=document.createTreeWalker(b),d=c.currentNode;return c.firstChild()?"BR"===c.currentNode.nodeName?d:a(c.currentNode):c.currentNode}var b=new c.api.Selection;if(b.range){b.placeMarkers();var d=c.allowsBlockElements()&&c.getHTML().match(/^<em class="scribe-marker"><\/em>/);if(b.removeMarkers(),d){var e=a(c.el.firstChild),f=b.range;f.setStart(e,0),f.setEnd(e,0),b.selection.removeAllRanges(),b.selection.addRange(f)}}}.bind(c));var e=function(){if(!c._skipFormatters){var a=new c.api.Selection,b=a.range,d=function(){b&&a.placeMarkers(),c.setHTML(c._htmlFormatterFactory.format(c.getHTML())),a.selectMarkers()}.bind(c);b?(c.undoManager.undo(),c.transactionManager.run(d)):d()}delete c._skipFormatters}.bind(c);b(c.el,e),c.allowsBlockElements()&&c.el.addEventListener("keydown",function(a){if(13===a.keyCode){var b=new c.api.Selection,d=b.range,e=b.getContaining(function(a){return/^(H[1-6])$/.test(a.nodeName)});if(e&&d.collapsed){var f=d.cloneRange();f.setEndAfter(e,0);var g=f.cloneContents();""===g.firstChild.textContent&&(a.preventDefault(),c.transactionManager.run(function(){var a=document.createElement("p"),c=document.createElement("br");a.appendChild(c),e.parentNode.insertBefore(a,e.nextElementSibling),d.setStart(a,0),d.setEnd(a,0),b.selection.removeAllRanges(),b.selection.addRange(d)}))}}}),c.allowsBlockElements()&&c.el.addEventListener("keydown",function(a){if(13===a.keyCode||8===a.keyCode){var b=new c.api.Selection,d=b.range;if(d.collapsed){var e=b.getContaining(function(a){return"LI"===a.nodeName});if(e&&""===e.textContent.trim()){a.preventDefault();var f=b.getContaining(function(a){return"UL"===a.nodeName||"OL"===a.nodeName}),g=c.getCommand("OL"===f.nodeName?"insertOrderedList":"insertUnorderedList");g.execute()}}}}),c.el.addEventListener("paste",function(b){if(b.clipboardData)b.preventDefault(),a(b.clipboardData.types,"text/html")?c.insertHTML(b.clipboardData.getData("text/html")):c.insertPlainText(b.clipboardData.getData("text/plain"));else{var d=new c.api.Selection;d.placeMarkers();var e=document.createElement("div");document.body.appendChild(e),e.setAttribute("contenteditable",!0),e.focus(),setTimeout(function(){var a=e.innerHTML;e.parentNode.removeChild(e),d.selectMarkers(),c.el.focus(),c.insertHTML(a)},1)}})}}}),define("plugins/core/formatters/html/replace-nbsp-chars",[],function(){return function(){return function(a){var b=/(\s|&nbsp;)+/g;a.registerHTMLFormatter("export",function(a){return a.replace(b," ")})}}}),define("lodash-amd/modern/arrays/last",["../functions/createCallback","../internals/slice"],function(a,b){function c(c,f,g){var h=0,i=c?c.length:0;if("number"!=typeof f&&null!=f){var j=i;for(f=a(f,g,3);j--&&f(c[j],j,c);)h++}else if(h=f,null==h||g)return c?c[i-1]:d;return b(c,e(0,i-h))}var d,e=Math.max;return c}),define("plugins/core/formatters/html/enforce-p-elements",["lodash-amd/modern/arrays/last","scribe-common/src/element"],function(a,b){function c(c){var d=Array.prototype.reduce.call(c.childNodes,function(c,d){function e(){var a=[d];c.push(a)}var f=a(c);if(f){var g=b.isBlockElement(f[0]);g===b.isBlockElement(d)?f.push(d):e()}else e();return c},[]),e=d.filter(function(a){var c=b.isBlockElement(a[0]);return!c});e.forEach(function(a){var b=document.createElement("p");a[0].parentNode.insertBefore(b,a[0]),a.forEach(function(a){b.appendChild(a)})}),c._isWrapped=!0}function d(a){for(var b=document.createTreeWalker(a,NodeFilter.SHOW_ELEMENT),e=b.firstChild();e;){if("BLOCKQUOTE"===e.nodeName&&!e._isWrapped){c(e),d(a);break}e=b.nextSibling()}}return function(){return function(a){a.registerHTMLFormatter("normalize",function(a){var b=document.createElement("div");return b.innerHTML=a,c(b),d(b),b.innerHTML})}}}),define("plugins/core/formatters/html/ensure-selectable-containers",["scribe-common/src/element","lodash-amd/modern/collections/contains"],function(a,b){function c(e){function f(b){return 0===b.children.length||1===b.children.length&&a.isSelectionMarkerNode(b.children[0])}for(var g=e.firstElementChild;g;)a.isSelectionMarkerNode(g)||(f(g)&&""===g.textContent.trim()&&!b(d,g.nodeName)?g.appendChild(document.createElement("br")):g.children.length>0&&c(g)),g=g.nextElementSibling}var d=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"];return function(){return function(a){a.registerHTMLFormatter("normalize",function(a){var b=document.createElement("div");return b.innerHTML=a,c(b),b.innerHTML})}}}),define("lodash-amd/modern/internals/htmlEscapes",[],function(){var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return a}),define("lodash-amd/modern/internals/escapeHtmlChar",["./htmlEscapes"],function(a){function b(b){return a[b]}return b}),define("lodash-amd/modern/internals/reUnescapedHtml",["./htmlEscapes","../objects/keys"],function(a,b){var c=RegExp("["+b(a).join("")+"]","g");return c}),define("lodash-amd/modern/utilities/escape",["../internals/escapeHtmlChar","../objects/keys","../internals/reUnescapedHtml"],function(a,b,c){function d(b){return null==b?"":String(b).replace(c,a)}return d}),define("plugins/core/formatters/plain-text/escape-html-characters",["lodash-amd/modern/utilities/escape"],function(a){return function(){return function(b){b.registerPlainTextFormatter(a)}}}),define("plugins/core/inline-elements-mode",[],function(){function a(a){for(var b=document.createTreeWalker(a);b.nextNode();)if(b.currentNode&&(~["br"].indexOf(b.currentNode.nodeName.toLowerCase())||b.currentNode.length>0))return!0;return!1}return function(){return function(b){b.el.addEventListener("keydown",function(c){if(13===c.keyCode){var d=new b.api.Selection,e=d.range,f=d.getContaining(function(a){return"LI"===a.nodeName||/^(H[1-6])$/.test(a.nodeName)});f||(c.preventDefault(),b.transactionManager.run(function(){"BR"===b.el.lastChild.nodeName&&b.el.removeChild(b.el.lastChild);var c=document.createElement("br");e.insertNode(c),e.collapse(!1);var f=e.cloneRange();f.setEndAfter(b.el.lastChild,0);var g=f.cloneContents();if(!a(g)){var h=document.createElement("br");e.insertNode(h)}var i=e.cloneRange();i.setStartAfter(c,0),i.setEndAfter(c,0),d.selection.removeAllRanges(),d.selection.addRange(i)}))}}.bind(this)),""===b.getHTML().trim()&&b.setContent("")}}}),define("plugins/core/patches/commands/bold",[],function(){return function(){return function(a){var b=new a.api.CommandPatch("bold");b.queryEnabled=function(){var b=new a.api.Selection,c=b.getContaining(function(a){return/^(H[1-6])$/.test(a.nodeName)});return a.api.CommandPatch.prototype.queryEnabled.apply(this,arguments)&&!c},a.commandPatches.bold=b}}}),define("plugins/core/patches/commands/indent",[],function(){var a="";return function(){return function(b){var c=new b.api.CommandPatch("indent");c.execute=function(c){b.transactionManager.run(function(){var d=new b.api.Selection,e=d.range,f="P"===e.commonAncestorContainer.nodeName&&"<br>"===e.commonAncestorContainer.innerHTML;if(f){var g=document.createTextNode(a);e.insertNode(g),e.setStart(g,0),e.setEnd(g,0),d.selection.removeAllRanges(),d.selection.addRange(e)}b.api.CommandPatch.prototype.execute.call(this,c),d=new b.api.Selection;var h=d.getContaining(function(a){return"BLOCKQUOTE"===a.nodeName});h&&h.removeAttribute("style")}.bind(this))},b.commandPatches.indent=c}}}),define("plugins/core/patches/commands/insert-html",["scribe-common/src/element"],function(a){return function(){return function(b){var c=new b.api.CommandPatch("insertHTML");c.execute=function(c){b.transactionManager.run(function(){function d(b){var c=document.createTreeWalker(b,NodeFilter.SHOW_ELEMENT),e=c.firstChild();if(e)do"SPAN"===e.nodeName?a.unwrap(b,e):(e.style.lineHeight=null,""===e.getAttribute("style")&&e.removeAttribute("style")),d(e);while(e=c.nextSibling())}b.api.CommandPatch.prototype.execute.call(this,c),d(b.el)}.bind(this))},b.commandPatches.insertHTML=c}}}),define("plugins/core/patches/commands/insert-list",["scribe-common/src/element","scribe-common/src/node"],function(a,b){return function(){return function(c){var d=function(a){c.api.CommandPatch.call(this,a)};d.prototype=Object.create(c.api.CommandPatch.prototype),d.prototype.constructor=d,d.prototype.execute=function(d){c.transactionManager.run(function(){if(c.api.CommandPatch.prototype.execute.call(this,d),this.queryState()){var e=new c.api.Selection,f=e.getContaining(function(a){return"OL"===a.nodeName||"UL"===a.nodeName});if(f.nextElementSibling&&0===f.nextElementSibling.childNodes.length&&b.removeNode(f.nextElementSibling),f){var g=f.parentNode;g&&/^(H[1-6]|P)$/.test(g.nodeName)&&(e.placeMarkers(),b.insertAfter(f,g),e.selectMarkers(),2===g.childNodes.length&&b.isEmptyTextNode(g.firstChild)&&b.removeNode(g),0===g.childNodes.length&&b.removeNode(g))}var h=Array.prototype.slice.call(f.childNodes);h.forEach(function(b){var c=Array.prototype.slice.call(b.childNodes);c.forEach(function(c){if("SPAN"===c.nodeName){var d=c;a.unwrap(b,d)}else c.nodeType===Node.ELEMENT_NODE&&(c.style.lineHeight=null,""===c.getAttribute("style")&&c.removeAttribute("style"))})})}}.bind(this))},c.commandPatches.insertOrderedList=new d("insertOrderedList"),c.commandPatches.insertUnorderedList=new d("insertUnorderedList")}}}),define("plugins/core/patches/commands/outdent",[],function(){return function(){return function(a){var b=new a.api.CommandPatch("outdent");b.execute=function(){a.transactionManager.run(function(){var b=new a.api.Selection,c=b.range,d=b.getContaining(function(a){return"BLOCKQUOTE"===a.nodeName});if("BLOCKQUOTE"===c.commonAncestorContainer.nodeName){b.placeMarkers(),b.selectMarkers(!0);var e=c.cloneContents();d.parentNode.insertBefore(e,d),c.deleteContents(),b.selectMarkers(),""===d.textContent&&d.parentNode.removeChild(d)}else{var f=b.getContaining(function(a){return"P"===a.nodeName});if(f){var g=new a.api.Node(f).nextAll();
if(g.length){var h=document.createElement(d.nodeName);g.forEach(function(a){h.appendChild(a)}),d.parentNode.insertBefore(h,d.nextElementSibling)}b.placeMarkers(),d.parentNode.insertBefore(f,d.nextElementSibling),b.selectMarkers(),""===d.innerHTML&&d.parentNode.removeChild(d)}else a.api.CommandPatch.prototype.execute.call(this)}}.bind(this))},a.commandPatches.outdent=b}}}),define("plugins/core/patches/commands/create-link",[],function(){return function(){return function(a){var b=new a.api.CommandPatch("createLink");a.commandPatches.createLink=b,b.execute=function(b){var c=new a.api.Selection;if(c.selection.isCollapsed){var d=document.createElement("a");d.setAttribute("href",b),d.textContent=b,c.range.insertNode(d);var e=document.createRange();e.setStartBefore(d),e.setEndAfter(d),c.selection.removeAllRanges(),c.selection.addRange(e)}else a.api.CommandPatch.prototype.execute.call(this,b)}}}}),define("plugins/core/patches/events",["scribe-common/src/element"],function(a){return function(){return function(b){b.allowsBlockElements()&&b.el.addEventListener("keyup",function(c){if(8===c.keyCode||46===c.keyCode){var d=new b.api.Selection,e=d.getContaining(function(a){return"P"===a.nodeName});e&&(b.undoManager.undo(),b.transactionManager.run(function(){d.placeMarkers();var b=Array.prototype.slice.call(e.childNodes);b.forEach(function(b){if("SPAN"===b.nodeName){var c=b;a.unwrap(e,c)}else b.nodeType===Node.ELEMENT_NODE&&(b.style.lineHeight=null,""===b.getAttribute("style")&&b.removeAttribute("style"))}),d.selectMarkers()}))}})}}}),define("plugins/core/patches",["./patches/commands/bold","./patches/commands/indent","./patches/commands/insert-html","./patches/commands/insert-list","./patches/commands/outdent","./patches/commands/create-link","./patches/events"],function(a,b,c,d,e,f,g){return{commands:{bold:a,indent:b,insertHTML:c,insertList:d,outdent:e,createLink:f},events:g}}),define("plugins/core/set-root-p-element",[],function(){return function(){return function(a){""===a.getHTML().trim()&&a.setContent("<p><br></p>")}}}),define("api/command-patch",[],function(){return function(a){function b(a){this.commandName=a}return b.prototype.execute=function(b){a.transactionManager.run(function(){document.execCommand(this.commandName,!1,b||null)}.bind(this))},b.prototype.queryState=function(){return document.queryCommandState(this.commandName)},b.prototype.queryEnabled=function(){return document.queryCommandEnabled(this.commandName)},b}}),define("api/command",[],function(){return function(a){function b(b){this.commandName=b,this.patch=a.commandPatches[this.commandName]}return b.prototype.execute=function(b){this.patch?this.patch.execute(b):a.transactionManager.run(function(){document.execCommand(this.commandName,!1,b||null)}.bind(this))},b.prototype.queryState=function(){return this.patch?this.patch.queryState():document.queryCommandState(this.commandName)},b.prototype.queryEnabled=function(){return this.patch?this.patch.queryEnabled():document.queryCommandEnabled(this.commandName)},b}}),define("api/node",[],function(){function a(a){this.node=a}return a.prototype.getAncestor=function(a){var b=function(a){return a&&a.attributes&&a.attributes.getNamedItem("contenteditable")};if(!b(this.node))for(var c=this.node.parentNode;c&&!b(c);){if(a(c))return c;c=c.parentNode}},a.prototype.nextAll=function(){for(var a=[],b=this.node.nextSibling;b;)a.push(b),b=b.nextSibling;return a},a}),define("api/selection",[],function(){return function(a){function b(){this.selection=window.getSelection(),this.selection.rangeCount&&(this.range=this.selection.getRangeAt(0))}return b.prototype.getContaining=function(b){var c=new a.api.Node(this.range.commonAncestorContainer),d=c.node&&c.node.attributes&&c.node.attributes.getNamedItem("contenteditable");return!d&&b(c.node)?c.node:c.getAncestor(b)},b.prototype.placeMarkers=function(){var a=document.createElement("em");a.classList.add("scribe-marker");var b=document.createElement("em");b.classList.add("scribe-marker");var c=this.range.cloneRange();if(c.collapse(!1),c.insertNode(b),b.nextSibling&&b.nextSibling.nodeType===Node.TEXT_NODE&&""===b.nextSibling.data&&b.parentNode.removeChild(b.nextSibling),b.previousSibling&&b.previousSibling.nodeType===Node.TEXT_NODE&&""===b.previousSibling.data&&b.parentNode.removeChild(b.previousSibling),!this.selection.isCollapsed){var d=this.range.cloneRange();d.collapse(!0),d.insertNode(a),a.nextSibling&&a.nextSibling.nodeType===Node.TEXT_NODE&&""===a.nextSibling.data&&a.parentNode.removeChild(a.nextSibling),a.previousSibling&&a.previousSibling.nodeType===Node.TEXT_NODE&&""===a.previousSibling.data&&a.parentNode.removeChild(a.previousSibling)}this.selection.removeAllRanges(),this.selection.addRange(this.range)},b.prototype.getMarkers=function(){return a.el.querySelectorAll("em.scribe-marker")},b.prototype.removeMarkers=function(){var a=this.getMarkers();Array.prototype.forEach.call(a,function(a){a.parentNode.removeChild(a)})},b.prototype.selectMarkers=function(a){var b=this.getMarkers();if(b.length){var c=document.createRange();c.setStartBefore(b[0]),c.setEndAfter(b.length>=2?b[1]:b[0]),a||this.removeMarkers(),this.selection.removeAllRanges(),this.selection.addRange(c)}},b.prototype.isCaretOnNewLine=function(){var a=this.getContaining(function(a){return"P"===a.nodeName});if(a){var b=a.innerHTML.trim();return"P"===a.nodeName&&("<br>"===b||""===b)}return!1},b}}),define("api/simple-command",[],function(){return function(a,b){function c(a,c){b.api.Command.call(this,a),this.nodeName=c}return c.prototype=Object.create(a.Command.prototype),c.prototype.constructor=c,c.prototype.queryState=function(){var a=new b.api.Selection;return b.api.Command.prototype.queryState.call(this)&&!!a.getContaining(function(a){return a.nodeName===this.nodeName}.bind(this))},c}}),define("api",["./api/command-patch","./api/command","./api/node","./api/selection","./api/simple-command"],function(a,b,c,d,e){return function(f){this.CommandPatch=a(f),this.Command=b(f),this.Node=c,this.Selection=d(f),this.SimpleCommand=e(this,f)}}),define("lodash-amd/modern/objects/assign",["../internals/baseCreateCallback","./keys","../internals/objectTypes"],function(a,b,c){var d=function(d,e,f){var g,h=d,i=h;if(!h)return i;var j=arguments,k=0,l="number"==typeof f?2:j.length;if(l>3&&"function"==typeof j[l-2])var m=a(j[--l-1],j[l--],2);else l>2&&"function"==typeof j[l-1]&&(m=j[--l]);for(;++k<l;)if(h=j[k],h&&c[typeof h])for(var n=-1,o=c[typeof h]&&b(h),p=o?o.length:0;++n<p;)g=o[n],i[g]=m?m(i[g],h[g]):h[g];return i};return d}),define("transaction-manager",["lodash-amd/modern/objects/assign"],function(a){return function(b){function c(){this.history=[]}return a(c.prototype,{start:function(){this.history.push(1)},end:function(){this.history.pop(),0===this.history.length&&(b.pushHistory(),b.trigger("content-changed"))},run:function(a){this.start();try{a&&a()}finally{this.end()}}}),c}}),define("undo-manager",[],function(){return function(a){function b(){this.position=-1,this.stack=[],this.debug=a.isDebugModeEnabled()}return b.prototype.maxStackSize=100,b.prototype.push=function(a){for(this.debug&&console.log("UndoManager.push: %s",a),this.stack.length=++this.position,this.stack.push(a);this.stack.length>this.maxStackSize;)this.stack.shift(),--this.position},b.prototype.undo=function(){return this.position>0?this.stack[--this.position]:void 0},b.prototype.redo=function(){return this.position<this.stack.length-1?this.stack[++this.position]:void 0},b}}),define("lodash-amd/modern/arrays/pull",[],function(){function a(a){for(var b=arguments,d=0,e=b.length,f=a?a.length:0;++d<e;)for(var g=-1,h=b[d];++g<f;)a[g]===h&&(c.call(a,g--,1),f--);return a}var b=[],c=b.splice;return a}),define("event-emitter",["lodash-amd/modern/arrays/pull"],function(a){function b(){this._listeners={}}return b.prototype.on=function(a,b){var c=this._listeners[a]||[];c.push(b),this._listeners[a]=c},b.prototype.off=function(b,c){var d=this._listeners[b]||[];c?a(d,c):delete this._listeners[b]},b.prototype.trigger=function(a,b){var c=this._listeners[a]||[];c.forEach(function(a){a.apply(null,b)})},b}),define("scribe",["lodash-amd/modern/objects/defaults","lodash-amd/modern/arrays/flatten","./plugins/core/commands","./plugins/core/events","./plugins/core/formatters/html/replace-nbsp-chars","./plugins/core/formatters/html/enforce-p-elements","./plugins/core/formatters/html/ensure-selectable-containers","./plugins/core/formatters/plain-text/escape-html-characters","./plugins/core/inline-elements-mode","./plugins/core/patches","./plugins/core/set-root-p-element","./api","./transaction-manager","./undo-manager","./event-emitter"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(b,p){o.call(this),this.el=b,this.commands={},this.options=a(p||{},{allowBlockElements:!0,debug:!1}),this.commandPatches={},this._plainTextFormatterFactory=new q,this._htmlFormatterFactory=new r,this.api=new l(this);var s=m(this);this.transactionManager=new s;var t=n(this);this.undoManager=new t,this.el.setAttribute("contenteditable",!0),this.el.addEventListener("input",function(){this.transactionManager.run()}.bind(this),!1),this.allowsBlockElements()?(this.use(k()),this.use(f()),this.use(g())):this.use(i()),this.use(h()),this.use(e()),this.use(j.commands.bold()),this.use(j.commands.indent()),this.use(j.commands.insertHTML()),this.use(j.commands.insertList()),this.use(j.commands.outdent()),this.use(j.commands.createLink()),this.use(j.events()),this.use(c.indent()),this.use(c.insertList()),this.use(c.outdent()),this.use(c.redo()),this.use(c.subscript()),this.use(c.superscript()),this.use(c.undo()),this.use(d())}function q(){this.formatters=[]}function r(){this.formatters={sanitize:[],normalize:[],"export":[]}}return p.prototype=Object.create(o.prototype),p.prototype.use=function(a){return a(this),this},p.prototype.setHTML=function(a,b){b&&(this._skipFormatters=!0),this.el.innerHTML=a},p.prototype.getHTML=function(){return this.el.innerHTML},p.prototype.getContent=function(){return this._htmlFormatterFactory.formatForExport(this.getHTML().replace(/<br>$/,""))},p.prototype.getTextContent=function(){return this.el.textContent},p.prototype.pushHistory=function(){var a=this.undoManager.stack[this.undoManager.position],b=a&&a.replace(/<em class="scribe-marker">/g,"").replace(/<\/em>/g,"");if(!a||a&&this.getContent()!==b){var c=new this.api.Selection;c.placeMarkers();var d=this.getHTML();return c.removeMarkers(),this.undoManager.push(d),!0}return!1},p.prototype.getCommand=function(a){return this.commands[a]||this.commandPatches[a]||new this.api.Command(a)},p.prototype.restoreFromHistory=function(a){this.setHTML(a,!0);var b=new this.api.Selection;b.selectMarkers(),this.trigger("content-changed")},p.prototype.allowsBlockElements=function(){return this.options.allowBlockElements},p.prototype.setContent=function(a){this.allowsBlockElements()||(a+="<br>"),this.setHTML(a),this.trigger("content-changed")},p.prototype.insertPlainText=function(a){this.insertHTML("<p>"+this._plainTextFormatterFactory.format(a)+"</p>")},p.prototype.insertHTML=function(a){this.getCommand("insertHTML").execute(this._htmlFormatterFactory.format(a))},p.prototype.isDebugModeEnabled=function(){return this.options.debug},p.prototype.registerHTMLFormatter=function(a,b){this._htmlFormatterFactory.formatters[a].push(b)},p.prototype.registerPlainTextFormatter=function(a){this._plainTextFormatterFactory.formatters.push(a)},q.prototype.format=function(a){var b=this.formatters.reduce(function(a,b){return b(a)},a);return b},r.prototype=Object.create(q.prototype),r.prototype.constructor=r,r.prototype.format=function(a){var c=b([this.formatters.sanitize,this.formatters.normalize]),d=c.reduce(function(a,b){return b(a)},a);return d},r.prototype.formatForExport=function(a){return this.formatters.export.reduce(function(a,b){return b(a)},a)},p});